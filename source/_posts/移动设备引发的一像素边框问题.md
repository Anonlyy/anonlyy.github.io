---
title: 移动设备引发的一像素边框问题
date: 2018-02-27 09:41:55
tags:
---


熟悉移动web开发的同学一定对**1像素边框问题**不陌生,随着移动端web项目越来越多,要求也越来越高，好多设计师都发现了，你们前端实现的边线为什么这么粗的，根本不是1像素，好吗？
一句很普通的`border: 1px solid white;`在PC端浏览器上会正常显示1px的边框,然而放在移动端时就不是1px的大小了，可以能是2px，也可能是1.5px等,这又是怎么回事呢？咱们继续往下看。


## 原因

讲原因我们得来认识几个关键词:

### 设备像素比 devicePixelRatio

>devicePixelRatio是设备上物理像素和设备独立像素(device-independent pixels (dips))的比例。
>公式表示就是：devicePixelRatio(设备像素比) = 物理像素 / 设备独立像素(dips)




 **物理像素：**
  物理像素（physical pixel）又称设备像素，设备能控制显示的最小单位，我们可以把这些像素看作成真实存在显示器上一个个的点.

 **设备独立像素:**
  也叫密度无关像素，可以认为是计算机坐标系统中的一个点，这个点代表一个可以由程序使用并控制的虚拟像素(比如：CSS 像素,只是在android机中CSS 像素就不叫”CSS 像素”了而是叫”设备独立像素”)，然后由相关系统转换为物理像素。

### 物理像素与设备独立像素之间的关系

在一定的条件下两者它们两者是可以相等的,比如：在PC端浏览器默认情况下（100%，即页面没被缩放），一个物理像素 = 一个设备独立像素。而在移动端可就不一样的，因为retina视网膜分辨率,
是苹果公司提出来的，可以把更多的像素点压缩至一块屏幕里，从而达到更高的分辨率并提高屏幕显示的细腻程度，目前大部分设备都用到了这种技术。这种分辨率在正常观看距离下足以使人肉眼无法分辨其中的单独像素。也被称为视网膜显示屏。

得出结论:
 - PC端浏览器因为物理像素=设备独立像素,所以一般情况下,设备像素比 devicePixelRatio等于1。
 - 而移动端因为为了更清晰的显示效果,使用了视网膜显示屏,所以物理像素不断地提高,但独立设备像素没有对应的提高,所以导致设备像素比 devicePixelRatio>1。


也就是说,以iphone8为例，其min-device-pixel-ratio的值为2，如果某元素的下边框的写法是：border: 1px solid color，即当PC端显示的是1px的下边框时，在iphone6中显示的就不是1px，而是2px;


## 解决方案
经过搜集,解决方案有很多种,经过推敲,有两种方案是比较灵活,适合放到项目中的.


### 1.伪类 + transform 实现

	<style>
		.scale-1px{
		  position: relative;
		  border:none;
		}
		//设备像素比为1.5
		@media (-webkit-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5),(min--moz-device-pixel-ratio: 2),(min-resolution: 2dppx) {
			.scale-1px:::after {
				content: '';
				position: absolute;
			  	bottom: 0;
			  	background: #000;
			  	width: 100%;
			  	height: 1px;
			  	-webkit-transform: scaleY(1/1.5);
			  	transform: scaleY(0.5);
			}
		}
		//设备像素比为2
		@media (-webkit-min-device-pixel-ratio: 2),(min-device-pixel-ratio: 2),(min--moz-device-pixel-ratio: 2),(min-resolution: 2dppx) {
			.scale-1px:::after {
				content: '';
				position: absolute;
			  	bottom: 0;
			  	background: #000;
			  	width: 100%;
			  	height: 1px;
			  	-webkit-transform: scaleY(0.5);
			  	transform: scaleY(0.5);
			}
		}
		//设备像素比为3
		@media (-webkit-min-device-pixel-ratio: 3),(min-device-pixel-ratio: 3),(min--moz-device-pixel-ratio: 3),(min-resolution: 3dppx) {
			.scale-1px:::after {
				content: '';
				position: absolute;
			  	bottom: 0;
			  	background: #000;
			  	width: 100%;
			  	height: 1px;
			  	-webkit-transform: scaleY(1/3);
			  	transform: scaleY(0.5);
			}
		}
	</style>
#### 优点:
- 所有场景都能满足
- 支持圆角(伪类和本体类都需要加border-radius)

#### 缺点:
- 对于已经使用伪类的元素(例如clearfix)，可能需要多层嵌套


### 2.viewport + rem 实现

同时通过设置对应viewport的rem基准值，这种方式就可以像以前一样轻松愉快的写1px了。

	<script>    
     	var viewport = document.querySelector("meta[name=viewport]");  
    	//下面是根据设备像素设置viewport
        if (window.devicePixelRatio == 1.5) {  
           viewport.setAttribute('content', 'width=device-width,initial-scale=0.6666666666666667, maximum-scale=0.6666666666666667, minimum-scale=0.6666666666666667, user-scalable=no');  
        }  
        if (window.devicePixelRatio == 2) {  
           viewport.setAttribute('content', 'width=device-width,initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=no');  
        }  
        if (window.devicePixelRatio == 3) {  
          viewport.setAttribute('content', 'width=device-width,initial-scale=0.3333333333333333, maximum-scale=0.3333333333333333, minimum-scale=0.3333333333333333, user-scalable=no');  
        }  
        var docEl = document.documentElement;
        var fontsize = 10 * (docEl.clientWidth / 320) + 'px';
        docEl.style.fontSize = fontsize;   
    </script> 


在devicePixelRatio = 1.5 时，输出viewport：

	<meta name="viewport" content="initial-scale=0.6666666666666667, maximum-scale=0.6666666666666667, minimum-scale=0.6666666666666667, user-scalable=no">

在devicePixelRatio = 2 时，输出viewport：

	<meta name="viewport" content="initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=no">

在devicePixelRatio = 3 时，输出viewport：

	<meta name="viewport" content="initial-scale=0.3333333333333333, maximum-scale=0.3333333333333333, minimum-scale=0.3333333333333333, user-scalable=no">
